---
title: "ETC1010: Data Modelling and Computing"
author: "Professor Di Cook, EBS, Monash U."
output: 
  learnr::tutorial:
    css: "css/logo.css"
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = TRUE,   
                      message = FALSE,
                      warning = FALSE,
                      collapse = TRUE,
                      fig.height = 6,
                      fig.width = 6,
                      fig.align = "center",
                      cache = FALSE)
tutorial_html_dependency()
library(tidyverse)
```

# Advanced data modeling

## Course web site

This is a link to the course web site, in case you need to go back and forth between tutorial and web materials: [http://dmac.dicook.org](http://dmac.dicook.org)

## Quantitative association matrices

### Data:  Example: Last 4 months of currency USD cross-rates

- Data extracted from http://openexchangerates.org/api/historical
- R packages `jsonlite`, processed with `tidyverse`, `lubridate`

```{r echo=FALSE, fig.width=3, fig.height=2}
library(tidyverse)
library(lubridate)
ru <- read_csv("data/rates_new.csv")
ru <- ru %>% arrange(date)
glimpse(ru)
ggplot(ru, aes(x=date, y=AUD)) + geom_line()
```

```{r echo=FALSE, fig.width=3, fig.height=2}
# Compute coefficient of variation. We will only analyse 
# currencies that have changes substantially over this time.
# Dates dropped
s <- apply(ru[,-1], 2, function(x) sd(x)/mean(x))
ru_sub <- ru[,which(s>0.005)+1]

# Remove non-currencies
ru_sub <- ru_sub %>% select(-ALL, -XAG, -XDR, -XPT)
ru_sub <- apply(ru_sub, 2, function(x) (x-mean(x))/sd(x))
ru_sub_t <- t(ru_sub)
ru_sub_t <- data.frame(ru_sub_t)
#ru_sub_t$curr <- as.factor(colnames(ru_sub)) # Add currency names
```

```{r}
# Compute distance between currencies
d <- as.matrix(dist(ru_sub_t, diag=TRUE, upper=TRUE))
colnames(d) <- as.factor(colnames(ru_sub))
rownames(d) <- as.factor(colnames(ru_sub))
quantile(d, probs=c(0, 0.25, 0.5, 0.75, 1))
d_zero <- d
#d_zero[d>7] <- 0
d_zero_tbl <- d_zero %>% 
  as_tibble() %>%
  mutate(curr1=rownames(d_zero)) %>%
  gather(curr2, dst, -curr1) %>%
  filter(dst<3) %>%
  filter(curr1 != curr2)
```

```{r}
# Make network
library(geomnet)
set.seed(10052016)
ggplot(data = d_zero_tbl, aes(from_id = curr1, to_id = curr2)) +
  geom_net(layout.alg = "kamadakawai",
    size = 2, labelon = TRUE, vjust = -0.6, ecolour = "grey60",
    directed =FALSE, fontsize = 3, ealpha = 0.5) +
    #xlim(c(-0.05, 1.05)) +
    theme_net() +
    theme(legend.position = "bottom")
```

## Share and share alike

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
