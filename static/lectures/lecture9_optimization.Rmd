---
title: "Linear Optimization: Model Building and Fitting"
author: "David T. Frazier"
date: "30/08/2017"
output:
  xaringan::moon_reader:
    css: ["default", "myremark.css"]
    self_contained: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false

---


```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(fig.align = 'center',echo=FALSE)
library(lpSolve)
```


#Linear Optimization

---
# Outline
- In general, optimization is a tool for decision making. 
    - Tells us the optimal input to our objective function $f(b)$
- So far, only considered $f(b)$ that is not linear in $b$. 
- What about $f(b)$ linear in $b$?
    - EX: $f(b) = b_1x_1 + b_2x_2-b_3x_3$
    - What if there are restrictions on $x_1,x_2,x_3$?
    - Can we just apply the same tools? 

---
# Linear Optimization Methods
- A linear optimization problem depends on 
    - decision variables, $x_1,x_2,...,x_n$ 
    - objective function $f=b_1x_1+b_2x_2+...+b_nx_n$ 
    - known $b_1,...,b_n$
    - linear constraints: restrictions on $x_1,...,x_n$. 
- Specific case of optimization where $f$ is linear.     
 
---
# Linear Optimization Methods
- Allow us to deal with cases where 
    - $f(b)$ linear in $b$?
    - there are restrictions on $x_1,x_2,x_3$.
    - Solve real world problems. 
- AIM: minimize or maximize some objective function $f$ (**same as before**)
    - Subject to restrictions, called **constraints**, on $x_1,x_2,x_3$.
    - Linearity of $f(b)$ in $b$. 

---
# Linear optimization Structure
- $\max_{x_1,...,x_n}b_1x_1+b_2x_2+...+b_nx_n$ subject to 
- $a_{11}x_{1}+...+a_{1n}x_{n}\leq RHS_{1}$
- $\cdots$
- $a_{m1}x_{1}+...+a_{mn}x_{n}\leq RHS_{n}$
- $x_{1},...,x_{n}\geq0$

---
# Example
-A farmer has 240 acres of land to plant. She needs to decides how many acres of corn to plant and how many acres of oats. She can make $40 per acre profit for corn and $30 per acre for oats. However, the corn takes 2 hours of labour per acre to harvest and the oats take only 1 hour per acre. She only has 320 hours of labour she can invest. To maximize her profit, how many acres of each should she plant?
    - What is the objective function?
    - What are the constraints?
---
# Example
-A farmer has 240 acres of land to plant. She needs to decides how many acres of corn to plant and how many acres of oats. She can make **$40 per acre profit for corn** and **$30 per acre for oats**. However, the *corn takes 2 hours of labour per acre to harvest* and the *oats take only 1 hour per acre*. She only has *320 hours of labour* she can invest. **To maximize her profit**, how many acres of each should she plant?
    - What is the objective function? 
    - What are the constraints?
    
---
# From words to Math
- Decision variables: corn $x$, oats $y$ (in acers)
- Obj. Fun.
    - Profit: $\Pi=40x+30y$
- Constraints? 
    - $2x+y\leq 320$
    - $x+y\leq 240$
- Mathematically: $$\max_{x,y}\Pi\;s.t.\;2 x+y\leq320;\;x+y\leq240.$$


---
# Modelling Assumptions in Linear Programming

- **Proportionality**: the contribution to the objective function and the left-hand-side of each constraint by each decision variable is proportional to the value of the decision variable.
- **Additivity**: the contribution to the objective function and the left-hand-side of each constraint by any decision variable is completely independent of any other decision variable and is additive (involving?addition).
- **Divisibility**: the quantities represented by each decision variable are innately divisible (i.e., fractional answers make sense).
- **Certainty**: the coefficients in the objective function and constraints are known with certainty.


---
# Example: Par, INC.
-The PAR, Inc company produces golf bags. 
-The managers are interested in expand production and also want to move to **medium** & **high** price bags.
-Bag production involves 4 steps:
    - Cutting and dyeing the material
    - Sewing
    - Finishing
    - Inspection & packaging   


---
# Example: Par, INC.
-The director of manufacturing estimated that each of the two options will result in the following number of hours at each department: 
    - Cutting and dyeing the material
        -Standard Bag: 7/10, Delux Bag: 1
    - Sewing
        -Standard Bag: 1/2, Delux Bag: 5/6
    - Finishing
        -Standard Bag: 1, Delux Bag: 2/3
    - Inspection & packaging   
        -Standard Bag: 1/10, Delux Bag: 1/4

---
# Example: Par, INC.
-After studying each department, the director estimates the following production capacities:
    - 630 hours of cutting and dyeing,
    - 600 hours of sewing,
    - 708 hours of finishing, and
    - 135 hours for inspection and packaging 
-The accounting manager estimates that the company's profit from a standard bag and a deluxe bag will be **$10** and **$9**, respectively.  

---
# Example: Par, INC.
- Decision Variables? 
    
- Objective function?
    
- Constraints?
---
# Example: Par, INC.
- Decision Variables? 
    - Number of bags of each type:
        - $S$ = standard bags
        - $D$ = delux bags
---
# Example: Par, INC.
- Objective function?
    - Maximize profit: $max_{S,D}10S+9D$
---
# Example: Par, INC.
- Constraints?
    - Cutting and dyeing the material
        - Standard Bag: 7/10, Delux Bag: 1; 630 hours
        - $(7/10)S+D\leq 630$
    - Sewing
        - Standard Bag: 1/2, Delux Bag: 5/6; 600 hours
        - $(1/2)S+(5/6)D\leq 600$
    - Finishing
        - Standard Bag: 1, Delux Bag: 2/3; 708 hours
        - $S+(2/3)D\leq 708$
    - Inspection & packaging   
        - Standard Bag: 1/10, Delux Bag: 1/4; 135 hours
        - $(1/10)S+(1/4)D\leq 135$
    - Number of bags can't be negative!!
        - $S,D\geq0$. 
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_1.jpg)
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_2.jpg)
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_3.jpg)
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_4.jpg)
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_5.jpg)
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_6.jpg)
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_7.jpg)
---
# Example: Par, INC.
- ![](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/par_inc_8.jpg)

---
# How to solve this in `R`?
- Just like `optim`, we need some numerical method to solve this optimization problem
- We'll make use of the `lpSolve` package in `R`. 
    - "Modeling and Solving Linear Programming with `R`."
- Similar to `optim` function
    - Takes function as input
    - initial values for parameters
- Main difference: Must now add in constraint information.
---
# Constraints in `lpSolve`
-  Constraint information must be entered in a particular way
- Three pieces of information
    - Constraint coefficients
    - Constraint direction
    - RHS value of the constraint
- Must be entered as a matrix    
- Each row of the matrix corresponds to a constraint
- Include inequality information in a separate line    

---
# Example: Par, INC
- Easiest to see from an example.
```{r, echo=TRUE}
library(lpSolve)
obj_fun <- c(10,9)
constr <- matrix(c(7/10,1,1/2,5/6,1,2/3,1/10,1/4),ncol = 2, byrow=TRUE)
const_dir <- c("<=","<=","<=","<=")
RHS <- c(630,600,708,135)
prod_sol <- lp("max",obj_fun,constr,const_dir,RHS)
prod_sol$solution
```
 
---
# Example: Solve Farm Prob.
- Problem: $$\max_{x,y}40x+30y,\;s.t.\;x+y\leq320;\;x+y\leq240.$$
```{r, echo=TRUE}
library(lpSolve)
obj_fun <- c(40,30)
constr <- matrix(c(2,1,1,1),ncol = 2, byrow=TRUE)
const_dir <- c("<=","<=")
RHS <- c(320,240)
prod_sol <- lp("max",obj_fun,constr,const_dir,RHS)
prod_sol$solution
```
---
# Example
- A small business sells two products, named Product 1 and Product 2.
Each tonne of Product 1 consumes 30 working hours, and each tonne of
Product 2 consumes 20 working hours. The business has a maximum of
2,700 working hours for the period considered. As for machine hours,
each tonne of Products 1 and 2 consumes 5 and 10 machine hours,
respectively. There are 850 machine hours available.

- Each tonne of Product 1 yields 20 Me of profit, while Product 2 yields
60 Me for each tonne sold. For technical reasons, the firm must produce
a minimum of 95 tonnes in total between both products. We need
to know how many tonnes of Product 1 and 2 must be produced to
maximize total profit.
---
# Example: Objective function?
- A small business sells two products, named Product 1 and Product 2.
Each tonne of Product 1 consumes 30 working hours, and each tonne of
Product 2 consumes 20 working hours. The business has a maximum of
2,700 working hours for the period considered. As for machine hours,
each tonne of Products 1 and 2 consumes 5 and 10 machine hours,
respectively. There are 850 machine hours available.

- Each tonne of Product 1 yields **20 Millon of profit**, while Product 2 yields
**60 Millon** for each tonne sold. For technical reasons, the firm must produce
a minimum of 95 tonnes in total between both products. We need
to know how many tonnes of Product 1 and 2 must be produced to
**maximize total profit**.
---
# Example: Objective function?
- Mathematically: $$\max_{p_1,p_2}20p_1+60p_2$$

---
# Example: Constraints?
- A small business sells two products, named Product 1 and Product 2.
Each tonne of **Product 1 consumes 30 working hours**, and each tonne of
**Product 2 consumes 20 working hours**. The business has a maximum of
**2,700 working hours** for the period considered. As for machine hours,
each tonne of **Products 1 and 2 consumes 5 and 10 machine hours**,
respectively. There are **850** machine hours available.

- Each tonne of Product 1 yields 20 Millon of profit, while Product 2 yields 60 Millon for each tonne sold. For technical reasons, the firm must produce
**a minimum of 95 tonnes in total** between both products. We need
to know how many tonnes of Product 1 and 2 must be produced to
maximize total profit.
---
# Example: Constraints?
- Mathematically: 
    - $30p_1+20p_2\leq 2700$
    - $5p_1+10p_2\leq850$
    - $p_1+p_2\geq 95$
    - $p_1,p_2\geq0$. 

---
# Example: Solution?
```{r, echo=TRUE}
library(lpSolve)
obj_fun <- c(20,60)
constr <- matrix(c(30,20,5,10,1,1),ncol = 2, byrow=TRUE)
const_dir <- c("<=","<=",">=")
RHS <- c(2700,850,95)
prod_sol <- lp("max",obj_fun,constr,const_dir,RHS)
prod_sol$solution
```

---
# Additional Examples
- Portfolio selection
- Transportation planning
- Advertising campaign planning

---
# Example: Portfolio Selection
- Select a specific investment stragey
- Variety of investment alternatives 
- Goal: maximize profit or minimize risk.  

---
# Example: Portfolio Selection
- Investment opportunity for a fund of $100,000.

- The company has been recommended to invest in the oil industry, steel industry or government bonds.

- Five investment opportunities: Atlantic Oil (7.3% return), Pacific Oil (10.3 %), Midwest Steel (6.4%), Huber Steel (7.5%) and Government bonds (4.5%).    

---
# Example: Portfolio Selection
- Investment guidelines:
    - Neither oil or steel industry should receive more than $50,000.
    - Amount invested in government bonds should be at least 25 percent of the steel industry investments.
    - The investment in Pacific Oil, the high-return but high-risk investment, cannot be more than 60 percent of the total oil industry investment.


---
# Example: Portfolio Selection
- Define the following decision variables:
    - X1 - Atlantic Oil 
    - X2 - Pacific Oil 
    - X3 - Midwest Steel 
    - X4 - Huber Steel 
    - X5 - Government bonds
    
---
# Example: Portfolio Selection
- Objective function?


---
# Example: Portfolio Selection
- Objective function?
    - $\max_{x_{1},...,x_{5}}.073x_{1}+.103x_{2}+.064x_{3}+.075x_{4}+.045x_{5}$
    
---
# Example: Portfolio Selection
- Constraints?

---
# Example: Portfolio Selection
- Constraints?
- Max fund 10000
    - $x_{1}+x_{2}+...+x_{5}\leq 100,00$
- Oil or steel no more than $50,000.
    - $x_{1}+x_{2}\leq 50,000$
    - $x_{3}+x_{4}\leq 50,000$
- Government bonds at least 25 percent of the steel industry investments.
    - $x_{5}\geq .25*(x_{3}+x_{4})$
- Pacific Oil investment, no more than 60 percent of the total oil industry investment.  
    - $x_{2}\leq .6*(x_{1}+x_{2})$
- $x_{1},...,x_{5}\geq0$

---
# Putting it together
- $\max_{x_{1},...,x_{5}}.073x_{1}+.103x_{2}+.064x_{3}+.075x_{4}+.045x_{5}$
    - $x_{1}+x_{2}+...+x_{5}\leq 100,00$
    - $x_{1}+x_{2}\leq 50,000$
    - $x_{3}+x_{4}\leq 50,000$
    - $x_{5}\geq .25*(x_{3}+x_{4})$
    - $x_{2}\leq .6*(x_{1}+x_{2})$
    - $x_{1},...,x_{5}\geq0$ 

---
# Integer Programs and Optimization

---
# Integer Optimization
- So far, assumed $x_{1},...,x_{n}$ infinitely divisible
    - i.e., continuous. 
- Not true in many cases
    - Can we sell partial apartments?
    - 
- **Integer linear programs**: Problems that are modeled as linear programs with the additional requirement that at least one variable must be integer.

---
# Integer Optimization
-Types of Integer Linear Optimization Models:
    - All-integer linear program
    - Mixed-integer linear program
    - Binary integer linear program

---
# Linear optimization Structure
- $\max_{x_1,...,x_n}b_1x_1+b_2x_2+...+b_nx_n$ subject to 
- $a_{11}x_{1}+...+a_{1n}x_{n}\leq RHS_{1}$
- $\cdots$
- $a_{m1}x_{1}+...+a_{mn}x_{n}\leq RHS_{n}$
    - $x_{1},...,x_{n}\geq0$; $x_{j}=0,1,2,...$ all $j=1,...,n$
    - $x_{1},...,x_{n}\geq0$; $x_{j}=0,1,2,...$; $x_{i}$, $i\neq j$, continuous
    - $x_{1},...,x_{n}\geq0$; $x_{j}=0,1$ for all $j=1,...,n$ 

---
# Linear optimization Structure
- Using `R`, can solve nearly exactly the same way
- All-integer
    - `lp("min", f, const.mat, const.dir, const.rhs, all.int=TRUE)`
- All-binary
    - `lp("min", f, const.mat, const.dir, const.rhs, all.bin=FALSE)`
- Mixed
    - `lp("min", f, const.mat, const.dir, const.rhs, int.vec)`
    - Numeric vector giving the indices of variables that are required to be integer.     - The length of this vector will therefore be the number of integer variables


---
# LP Relaxation

- In many cases, we can simply treat the decision variables as continuous
    - Then solve the optimization problem, 
    - Round (up or down) to nearest integer.
- Called LP relaxation

---
# LP Relaxation
- Gives a near-optimial solution
- Rounding may not always be a good strategy. 
    - If decision variables take on small values
    - Can have major impact on the value of the objective function or feasibility, 
    - In such cases, optimal integer solution is needed. 

---
# All Integer Example: Eastborne Realty
- Eastborne Realty has $2 million available for the purchase of new rental property.
- After an initial screening, Eastborne reduced the investment alternatives to townhouses and apartment buildings. 
- Each townhouse can be purchased for $282,000.
    - Five are available.
- Each apartment building can be purchased for $400,000.
    - The developer will construct as many buildings as Eastborne wants to purchase.


---
# All Integer Example: Eastborne Realty
- Eastborne Realty has $2 million available for the purchase of new rental property.
- After an initial screening, Eastborne reduced the investment alternatives to townhouses and apartment buildings. 
    - $T$- townhouse, $A$- apartment.
- Each townhouse can be purchased for 282,000
    - Five available: $T\leq 5$
- Each apartment can be purchased for 400,000. Develope construct as many as desired.
    - $282T+400A\leq 2000$
    
---
# All Integer Example: Eastborne Realty
- Property manager can devote 140 hours per month to properties.
- Each townhous requires 4 hours per month.
- Each apartment requires 40 hours per month. 

---
# All Integer Example: Eastborne Realty
- Property manager can devote 140 hours per month to properties.
- Each townhous requires 4 hours per month.
- Each apartment requires 40 hours per month. 
    - $4T+40A\leq 140$

---
# All Integer Example: Eastborne Realty
- Annual cash flow (After deducting mortgage payments and operating expenses) estimated to be:
    - $10,000 per townhouse.
    - $15,000 per apartment building.
- The objective: Determine the number of townhouses and the number of apartment buildings to purchase to maximize annual cash flow.


---
# All Integer Example: Eastborne Realty
- Defining the decision variables:
    - $T$ = number of townhouses
    - $A$ = number of apartment buildings
- Objective function for cash flow (in thousands):
    - $max_{T,A}10T+15A$
- Constraints?
    - Available funds: $282T+400A\leq 2000$
    - Management: $4T+40A\leq 140$
    - Available funds: $282T+400A\leq 2000$
    - Available Townhouses: $T\leq 5$
    - Non-negative: $T,A\geq0$
    - Integer: $T,A$ integers
    
---
# Example: Eastborne Realty
- ![LP Relax](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/lp_relax.png)
  
---
# Example: Eastborne Realty

```{r, echo=TRUE}
library(lpSolve)
obj_fun <- c(10,15)
constr <- matrix(c(282,400,4,40,1,0),ncol = 2, byrow=TRUE)
const_dir <- c("<=","<=","<=")
RHS <- c(2000,140,5)
# LP relax
prod_sol <- lp("max",obj_fun,constr,const_dir,RHS)
prod_sol$solution
# Exact relax
prod_sol <- lp("max",obj_fun,constr,const_dir,RHS,all.int=TRUE)
prod_sol$solution
```

---
# A note on LP
- Rounding is a trial-and-error approach. 
- Each rounded solution must be evaluated for feasibility as well as for its impact on the value of the objective function.
- Even when a rounded solution is feasible, there is no guarantee that the optimal integer solution has been found. 

---
# Example: Eastborne Realty
- What 
- What is the true feasible region for the Eastborne Realty problem? 
    - As shown in the following plot, the feasible region is the set of integer points that lie within the feasible region of the LP Relaxation.
    - There are 20 such feasible solutions (designated by blue dots in the figure). 
- The region bounded by the dashed lines is the feasible integer solutions.


---
#Example: Eastborne Realty
- ![LP Relax](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/lp_relax2.png)    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    