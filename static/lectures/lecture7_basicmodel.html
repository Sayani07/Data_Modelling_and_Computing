<!DOCTYPE html>
<html>
  <head>
    <title>Model Building and Fitting</title>
    <meta charset="utf-8">
    <meta name="author" content="David T. Frazier" />
    <link href="lecture7_basicmodel_files/remark-css-0.0.1/example.css" rel="stylesheet" />
    <link rel="stylesheet" href="myremark.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Model Building and Fitting
### David T. Frazier
### 30/08/2017

---







# Overview
- Modeling Basics with R
- Building Models: Linearity
- How to fit models? Optimization
    - Nonlinear optimization
- Linear Optimization
    - Basics
    - Examples

---
# Modeling Basics in R

---
# But Why Models?
- EDA allows us to understand that variables are related, but **not necessarily how** 
- Models allow us to understand
    - how variables are related, strength of relationship, direction of relationship
- More than correlation and direction 
    - Correlation can be [spurrious](www.tylervigen.com/spurious-correlations)
    - ![Decieving](/Users/frazdt/Dropbox/ETC1010/S2_2017_Notes/Picture1.png)

---
# But Why Models? 
- ''The goal of a model is to provide a simple low-dimensional summary of a dataset.''
- A **family of models** express a relationship between different variables.
- Allow us to predict outcomes of interest, given other variables!
- Prediction is critical in many fields


---
# Model Familieis
- Model Family describes a relationship between an outcome `\((Y)\)` and an input, covariate, pre-determined variable `\((X)\)`.
- EX: `\(Y=b_0 + b_1 X +b_2 X^2+...+b_p X^p\)`
    - Class of polynomials in `\(X\)`
    - If `\(b_2=b_3=...=b_p=0\)`, linear relationship
- EX: `\(F=m\cdot a\)`

---
# Example
- Alumni Giving
- scatter plot can inform us about model structure
&lt;img src="lecture7_basicmodel_files/figure-html/unnamed-chunk-1-1.png" style="display: block; margin: auto;" /&gt;
---
# Example
&lt;img src="lecture7_basicmodel_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;

---
# Stat with a Family
- Linear models are always useful!
- How to find the best model?

---
# Linear Models
- `\(Y = b_0 + b_1 X\)`
- Find `\(b_0\)` and `\(b_1\)` that generate the **model** with the **smallest distance from the data**
- **Distance** between Observed `\(Y\)` and `\(b_0 +b_1 X\)`
- **Smallest** over the sample `\((y_i,x_i),i=1,...,n\)`

---
# Potential Distances
- Need a measure of distance between `\(y_i\)` and `\(b_0+b_1 x_i\)` (over `\(i=1,...,n\)`)
- What about `\(\sum_{i}\{y_i - b_0 -b_1 x_i\}^2\)`?
    - Just OLS!!!
&lt;img src="lecture7_basicmodel_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

---
# Other distances?
- What about `\(\sum_{i}|y_i - b_0 -b_1 x_i|\)`?
    - Called least absolute deviations.
  
&lt;img src="lecture7_basicmodel_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;
---
# Other distances?
- What about `\(\sum_{i}(y_i - b_0 -b_1 x_i)^{3}\)`?
  
&lt;img src="lecture7_basicmodel_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;
---
# Other distances?
- What about `\(\sqrt{\sum_{i}(y_i - b_0 -b_1 x_i)^4}\)`?
  
&lt;img src="lecture7_basicmodel_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

---
# Different distances
- Different distances measure different things
    - `\(d\{y_i,b_0+b_1x_i\}=y-b_0-b_1 x,\)`
    - `\(d\{y_i,b_0+b_1x_i\}=|y-b_0-b_1 x|,\)` 
    - `\(d\{y_i,b_0+b_1x_i\}=(y-b_0-b_1 x)^2\)` 
- `\(f(b_0,b_1)=\sum_{i}d\{y_i,b_0+b_1x_i\}\)` is called **the objective function**
- Takes in 
    - data: `\((y_i,x_i)\)`
    - parameters: `\(b_0,b_1\)`
- Outputs
    - measure of distance between `\(y_{i}\)` and `\(b_0+b_{1}x_{i}\)` over sample
---
# What was the goal again?
- Find the "best" model in the linear family...
- I.E., find `\(b_0,b_1\)` that "generate the **model** with the **smallest distance from the data**"
- Translation: Find `\(b_0,b_1\)` that makes `\(f(b_0,b_1)\)` **small**.

---
# Optimization
- This is called Optimization.
- Solution will depend on `\(f(b_0,b_1)\)`
- How to find `\(b_0,b_1\)`?

---
# Optimization
- `\(min_{b_0,b_1}\sum_{i}d\{y_i,b_0+b_1x_i\}\)`
    - Ex: `\({\sum_{i}\{y_i-b_0-b_1x_i\}^2}\)`
        - Ordinary least squares
    - Ex: `\(\sum_{i}|y_i-b_0-b_1x_i|\)`
        - Last absolute deviations
- How can we find the minimum?

---
# Method 1: Grid Search
- Construct grid of values `\(b_0,b_1\)`.
- Evaluate `\(f(b_0,b_1)\)`.
- Find `\(b_0,b_1\)` that make `\(f(b_0,b_1)\)` smallest.

---
# Grid Search con't.
- Alumni giving dataset  

```r
model1 &lt;- function(b, data) {
  b[1] + data$x * b[2]}

measure_distance1 &lt;- function(mod, data) {
  diff &lt;- data$y - model1(mod, data)
  (sqrt(mean(diff^2 )))}

sim1_dist &lt;- function(b0, b1) {
  measure_distance1(c(b0, b1), data)}

grid &lt;- expand.grid(
  b0 = seq(40, 65, length = 100),
  b1 = seq(-3, 0, length = 100)
  ) %&gt;% 
  mutate(dist = purrr::map2_dbl(b0, b1, sim1_dist))
c(grid$b0[grid$dist==min(grid$dist)],grid$b1[grid$dist==min(grid$dist)])
```

```
## [1] 53.131313 -2.060606
```
---
# Grid Search con't.
- Built in function to do OLS in `R`  

```r
fit1&lt;- lm(y~x,data)
fit1$coefficients
```

```
## (Intercept)           x 
##   53.013827   -2.057155
```
- More on this later, but check out `?lm` for now...
---
# Grid Search con't.
- Alumni giving dataset  

```r
model1 &lt;- function(b, data) {
  b[1] + data$x * b[2]}

measure_distance1 &lt;- function(mod, data) {
  diff &lt;- data$y - model1(mod, data)
  ((mean(abs(diff) )))}

sim1_dist &lt;- function(b0, b1) {
  measure_distance1(c(b0, b1), data)}

grid_o &lt;- expand.grid(
  b0 = seq(40, 65, length = 100),
  b1 = seq(-3, 0, length = 100)
  ) %&gt;% 
  mutate(dist = purrr::map2_dbl(b0, b1, sim1_dist))
c(grid_o$b0[grid_o$dist==min(grid_o$dist)],grid_o$b1[grid_o$dist==min(grid_o$dist)])
```

```
## [1] 49.090909 -1.848485
```

---
# General optimization
- Grid search not very useful in higher dimension
- How to set the grid?
- Need general approach

---
# `optim` function in R...
- Allows you to optimize user supplied functions
- Works with non-differentiable functions
- Syntax: `optim(init, f, method="NM")`
    - init: initial values for the optimizer
    - f: objective function
    - method: different optimization routines
    - More on this later

---
#`optim` Example
- Example: Alumni Giving

```r
measure_distance2 &lt;- function(mod, data) {
  diff &lt;- data$y - model1(mod, data)
  sqrt((mean((diff )^2)))
}
measure_distance3 &lt;- function(mod, data) {
  diff &lt;- data$y - model1(mod, data)
  (mean(abs(diff )))
}
best2 &lt;- optim(c(0, 0), measure_distance2, data = data)
best2$par
```

```
## [1] 53.00956 -2.05699
```

```r
best3 &lt;- optim(c(0, 0), measure_distance3, data = data)
best3$par
```

```
## [1] 49.142933 -1.857148
```

---
#`optim` in R
- Example: Alumni Giving

```r
measure_distance2 &lt;- function(mod, data) {
  diff &lt;- data$y - model1(mod, data)
  ((mean((diff )^(3/2))))
}

best2 &lt;- optim(c(0, 0), measure_distance2, data = data)
best2$par
```

```
## [1] 21.2216110 -0.7684676
```
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
