---
title: "ETC 1010 Assignment 1"
author: "Professor Di Cook, EBS, Monash U."
output: html_document
---

```{r, echo = FALSE, message = FALSE, warning = FALSE, warning = FALSE}
knitr::opts_chunk$set(
  echo=FALSE,
  message = FALSE,
  warning = FALSE,
  error = FALSE, 
  collapse = TRUE,
  comment = "",
  fig.height = 8,
  fig.width = 12,
  fig.align = "center",
  cache = FALSE
)
```

![](https://www.abc.net.au/news/image/6018818-3x2-940x627.jpg)

# Background

Federal elections are held in Australia approximately every three years, with the exact timing at the pleasure of the party in government. It is rumoured that the next election will be in May 2019. The ads have already started on TV, "Australians aren't going to cop it" is the catch phrase of one minor party, robocalls have begun, ads are appearing in facebook, and voting preference polling is in full swing. This assignment is asking you to work with different publicly available data on the election, with a goal to practice tidying and wrangling skills, with an added side effect of learning about the Australian political landscape.

# Instructions

- This is a team assignment. 
- You need to write a report with answers to each of the questions. 
- Turn in the `html` output file, and also the `Rmd` file. 
- Total points for the assignment is 20. Five points of the score from the assignment will be given by another team, who will give you full marks if they can compile your report, and get the same answers as you, and find your explanations of the plots understandable and informative. Five points will be for individual effort. And the remaining 10 points will be the final group report.

# About the data

- Data 1: Australian Election Study Interactive Data  (AESID) available from https://www.australianelectionstudy.org/voter_studies.html as the "1987-2016 Trends" `xlsx` format spreadsheet.
- Data 2: First party preferences electorate level votes from 2016 (FPP) available from https://results.aec.gov.au/20499/Website/HouseDownloadsMenu-20499-Csv.htm as "First preferences by candidate by vote type" in `csv` format. 

# Exercise


```{r eval=FALSE}
library(readxl)
library(tidyverse)
aec <- read_xlsx("aec/Australian Election Study Interactive Data - Cameron and McAllister 2018.xlsx", sheet="1.5", col_names = c("v1", "v2", "1993", "1996","1998", "2001", "2004", "2007", "2010", "2013", "2016"), range="A3:K36")
aec_l <- aec %>% gather(year, pct, `1993`:`2016`) %>%   
  mutate(year = as.numeric(year)) %>%
  rename(communication = v1)

aec_3.1 <- read_xlsx("aec/Australian Election Study Interactive Data - Cameron and McAllister 2018.xlsx", sheet="3.1", col_names = c("v1", "v2", "1990", "1993", "1996","1998", "2001", "2004", "2007", "2010", "2013", "2016"), range="A3:L87")
aec_3.1_l <- aec_3.1 %>% gather(year, pct, `1990`:`2016`) %>%   
  mutate(year = as.numeric(year)) %>%
  rename(issue = v1)
```


1. Download the AESID data. This is a multisheet excel file. The first sheet gives an overview of how the data was collected. The second sheet provides details on the data in different sheets. Take a look at sheet `1.5` 

a. Make a sketch of what's in this sheet. Particularly map out the variables, and different types of aggregations. How many variables are there in this sheet? List them. How often was the survey conducted? Did the researchers adjust percentages to account for differences between sample and  population demographics? Write a few sentences about the data is in this sheet, in particular how this data might help us to answer the question "What is the trend in the ways people of different ages discuss politics?"

**6 variables**

**year**, **communication** (Discuss politics, Persuade others how to vote), **age** (18-24, 25-34, 35-44, 45-54, 55-64, 65plus), **education** (No qualification, Non-tertiary qualification, Tertiary qualification ), **gender** (Female, Male), **vote** (Greens, Labor Party, Liberal Party, National Party, Other). 

b. Turn the data into long form, where year is in a column. 

c. Remove the rows corresponding to overall aggregates.

d. Rename the first column to "communication".

e. Separate the second column into two, one called "variable", and the second called "level".

f. Subset to have only rows corresponding to the variable "age".

g. Convert `year` into a numeric variable.

h. Make a line plot showing the percentage of people who "Discuss politics" by year, overlaid with one for "Persuade others how to vote".

i. Write a paragraph on what you learn from this plot. It seems that there was a big drop in people reporting talking about politics after 1998. Using your internet searching skills, do some research to find out plausible reasons for the big drop in these percentages, and describe what you have learned.

2. Download the FPP data, and read the data into R.

```{r eval=FALSE}
library(tidyverse)
fpp <- read_csv("aec/HouseFirstPrefsByCandidateByVoteTypeDownload-20499.csv", skip=1)
```

a. Take a look at the structure of the data file. Is this data in tidy format? Explain your answer.

b. Count the number of candidates in each electorate. What is the most number of candidates in any electorate? What is the least? What is the average number of candidates per electorate?

```{r eval=FALSE}
fpp %>% count(DivisionNm, sort=TRUE)
fpp %>% count(DivisionNm) %>% filter(n == min(n))
fpp %>% count(DivisionNm, sort=TRUE) %>% summarise(mean(n))
```

c. Filter the data on the candidates who won the electorate. Summarise the number of electorates won by each party. Make a plot of the distribution of percentage of the vote that each winner won by.

d. Make a list of the electorates where the winner did not get the majority first preferences. 

e. Which party received the least votes over the country?

```{r eval=FALSE}
fpp %>% group_by(PartyNm) %>% summarise(tot=sum(TotalVotes, na.rm=TRUE)) %>% arrange(tot)
```

f. Write an explanation of preferential voting as it is used in Australia, and how first preferences factor in to the final result. 


3. Install the `eechidna` package from ... Examine population in electorates, make a map of the election results

<!--
2. Subset the data accordingly, and make a line plot of the percentage of people who "Discuss politics" by year. (Hint: `year` needs to be converted to a numeric variable.)

```{r eval=FALSE}
aec_l %>% filter(is.na(v2)) %>% 
  select(-v2) %>%
  ggplot(aes(x=year, y=pct, colour=communication)) + 
  geom_point() +
  geom_line() + 
  scale_colour_brewer("", palette="Dark2") +
  ylab("Percentage") + 
  scale_x_continuous("", breaks=seq(1993, 2016, 2), 
    labels=c("93", "95", "97", "99", "01", "03", "05", "07", "09", "11", "13", "15")) +
  theme(legend.position="bottom")
```

3. Gender and communication

```{r eval=FALSE}
aec_l %>% filter(!is.na(v2)) %>% 
  separate(v2, c("var", "level"), extra="merge") %>%
  filter(var == "Gender") %>%
  ggplot(aes(x=year, y=pct, colour=level)) +
    geom_point() +
    geom_line() + 
    facet_wrap(~communication) +
    scale_colour_brewer("", palette="Dark2") +
    ylab("Percentage") + 
    scale_x_continuous("", breaks=seq(1993, 2016, 2), 
       labels=c("93", "95", "97", "99", "01", "03", "05", "07", "09", "11", "13", "15")) +
  theme(legend.position="bottom")
```

4. Age and communication

```{r eval=FALSE}
aec_l %>% filter(!is.na(v2)) %>% 
  separate(v2, c("var", "level"), extra="merge") %>%
  filter(var == "Age") %>%
  ggplot(aes(x=year, y=pct, colour=level)) +
    geom_point() +
    geom_line() + 
    facet_wrap(~communication) +
    scale_colour_brewer("", palette="Dark2") +
    ylab("Percentage") + 
    scale_x_continuous("", breaks=seq(1993, 2016, 2), 
       labels=c("93", "95", "97", "99", "01", "03", "05", "07", "09", "11", "13", "15")) +
  theme(legend.position="bottom")
```

5. Vote and communication

```{r eval=FALSE}
aec_l %>% filter(!is.na(v2)) %>% 
  separate(v2, c("var", "level"), extra="merge") %>%
  filter(var == "Vote") %>%
  ggplot(aes(x=year, y=pct, colour=level)) +
    geom_point() +
    geom_line() + 
    facet_wrap(~communication) +
    scale_colour_brewer("", palette="Dark2") +
    ylab("Percentage") + 
    scale_x_continuous("", breaks=seq(1993, 2016, 2), 
       labels=c("93", "95", "97", "99", "01", "03", "05", "07", "09", "11", "13", "15")) +
  theme(legend.position="bottom")
```


6. Issue and party

```{r eval=FALSE}
aec_3.1_l %>% filter(is.na(v2)) %>% 
  select(-v2) %>%
  ggplot(aes(x=year, y=pct, colour=issue)) + 
  geom_point() +
  geom_line() + 
  scale_colour_brewer("", palette="Dark2") +
  ylab("Percentage") + 
  scale_x_continuous("", breaks=seq(1989, 2016, 2), 
    labels=c("89", "91", "93", "95", "97", "99", "01", "03", "05", "07", "09", "11", "13", "15")) +
  theme(legend.position="bottom")
```

```{r eval=FALSE}
aec_3.1_l %>% filter(!is.na(v2)) %>% 
  separate(v2, c("var", "level"), extra="merge") %>%
  filter(var == "Vote") %>%
  ggplot(aes(x=year, y=pct, colour=level)) +
    geom_point() +
    geom_line() + 
    facet_wrap(~issue) +
    scale_colour_brewer("", palette="Dark2") +
    ylab("Percentage") + 
    scale_x_continuous("", breaks=seq(1993, 2016, 2), 
       labels=c("93", "95", "97", "99", "01", "03", "05", "07", "09", "11", "13", "15")) +
  theme(legend.position="bottom")
```



2. Combine the data from the three different census periods

3. Aggregate the counts across sex, and age, and compute the totals across educ, for each census. Plot these totals against the census year, using a line connecting values for each educ group. Write a couple of paragraphs about what you learn.

4. Subset the data to age group 25-29. Make a plot of educ counts by census year, facetted by sex. Write a couple of paragraphs about what you learn.

5. Subset the data to age groups, 15-19, 20-24, 25-29, 30-34. Make a plot of educ counts by census year, facetted by age group and sex. Write a couple of paragraphs about what you learn.

-->
