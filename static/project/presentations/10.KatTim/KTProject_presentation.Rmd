---
title: "ETC1010 Assignment - An International Analysis of Economic Health"
author: "Katarina Dutt & Tim Hantzipavlis"
date: "Week 12"
output:
  xaringan::moon_reader:
    css: ["default","myremark.css"]
    self_contained: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  echo=FALSE,
  comment = "",
  fig.height = 4,
  fig.width = 8,
  fig.align = "center",
  cache = FALSE
)

library(tidyverse)
library(readr)
data <- read.csv("countries of the world.csv", dec = ",") %>%
#Remove spaces at end of country names
  mutate("Country" = as.character(Country)) %>%
  separate(Country, into = c("Country", "spaces"), sep = " $") %>%
  select(-spaces) %>%
#Remove spaces at end of region names
  mutate("Region" = as.character(Region)) %>%
  separate(Region, into = c("Region", "i_love_etc1010"), sep = "  ") %>%
  select(-i_love_etc1010) %>%
  separate(Region, into = c("Region", "kat_is_a_potato"), sep = " $") %>%
  select(-kat_is_a_potato) %>%
#Rename variables
  rename("Area" = "Area..sq..mi..", 
         "Population_density" = "Pop..Density..per.sq..mi..",
         "Coastline_ratio" = "Coastline..coast.area.ratio.",
         "Net_migration" = "Net.migration",
         "Infant_mortality" = "Infant.mortality..per.1000.births.",
         "GDP_per_capita" = "GDP....per.capita.",
         "Literacy_rate" = "Literacy....",
         "Phones" = "Phones..per.1000.",
         "Arable" = "Arable....",
         "Crops" = "Crops....",
         "Other" = "Other....",
         "Birth_rate" = "Birthrate",
         "Death_rate" = "Deathrate")
```

# Content

- Data Description
- Cleaning and Tidying Our Data 
- Visualisations, Analysis and Findings 
- Conclusions
- References

---
# Data description

- We sourced our data from Kaggle (recently acquired by Google), frequented mainly by statisticians and data miners. 
- Our dataset 'Countries of the World' contains data from 228 countries. 
- Interested in investigating factors which influence economic health as well as variables which act as good measures of economic health based on their relationships with GDP Per Capita. 
- URL:https://www.kaggle.com/fernandol/countries-of-the-world/data

---
#  Variables of Interest 
-  Geographic: Country, Region, Climate & Coastal 
-  Population: Population Density, Birth Rate, Death Rate & Net Migration 
-  Health: Infant Mortality
-  Education: Literacy Rate 
-  Revenue Sectors: Agriculture, Industry & Service 
-  Material: GDP per Capita & Phones per 1000
---
#  Research Questions

- 1.Do countries with lower population densities have higher GDP per Capita? 
- 2.Which global regions are people tending to migrate to and which regions are people tending to emigrate from? 
- 3.Does a country's climate type relate to their GDP per Capita? 
- 4.What relationships exist between Infant Mortality, GDP per Capita, Literacy Rates and Phones per 1000? 
- 5.How does GDP vary across regions? 
- 6.What sectors do countries from different regions primarily rely on as a source of income? 
---
###   Tidying and Cleaning of Data
- Used read-in functions to:
  - Convert commas to decimals
  - Rename variables
  - Remove unwanted spaces in strings
```{r}
library(visdat)
library(naniar)
vis_dat(data)
```
- Removed one entry due to missing values for majority of variables
- 65% of variables contain missing values
- However, overall proportion of missing values is only 2%
- Therefore, there is enough data to impute values for each variable
---
### Imputation - Birth Rate
- Plot of Birth Rate against Phones
```{r}
ggplot(data, aes(x = Phones, y = Birth_rate)) + 
  geom_point()
```
- Clear non-linear relationship
- Apply log tranformation to Phones
```{r}
data <- data %>% mutate(Population_density = ifelse(Population_density == 0, Population/Area, Population_density))
data <- data %>% mutate(Net_migration = ifelse(is.na(Net_migration), mean(Net_migration, na.rm = TRUE), Net_migration)) %>%
  mutate(Infant_mortality = ifelse(is.na(Infant_mortality), mean(Infant_mortality, na.rm = TRUE), Infant_mortality))
data_shadow <- bind_shadow(data)
mod_lit <- lm(data %>% filter(Phones != is.na(Phones)), formula = Literacy_rate  ~ poly(Phones, 2))
data_shadow <- data_shadow %>% mutate(Literacy_rate = ifelse(is.na(Literacy_rate), ifelse(predict(mod_lit)<=100, predict(mod_lit), 100), Literacy_rate))
mod_phones <- lm(data, formula = Phones ~ GDP_per_capita)
data_shadow <- data_shadow %>% mutate(Phones = ifelse(is.na(Phones), predict(mod_phones), Phones))
data_shadow <- data_shadow %>% mutate(Arable = ifelse(is.na(Arable), mean(Arable, na.rm = TRUE), Arable)) %>% 
  mutate(Crops = ifelse(is.na(Crops), mean(Crops, na.rm = TRUE), Crops)) %>%
  mutate(Other = ifelse(is.na(Other), 1-Arable-Crops, Other))
r1 <- data_shadow %>%
  filter(Region == "ASIA (EX. NEAR EAST)") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r2 <- data_shadow %>%
  filter(Region == "BALTICS") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r3 <- data_shadow %>%
  filter(Region == "C.W. OF IND. STATES") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r4 <- data_shadow %>%
  filter(Region == "EASTERN EUROPE") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r5 <- data_shadow %>%
  filter(Region == "LATIN AMER. & CARIB") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r6 <- data_shadow %>%
  filter(Region == "NEAR EAST") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r7 <- data_shadow %>%
  filter(Region == "NORTHERN AFRICA") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r8 <- data_shadow %>%
  filter(Region == "NORTHERN AFRICA") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r9 <- data_shadow %>%
  filter(Region == "NORTHERN AMERICA") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r10 <- data_shadow %>%
  filter(Region == "OCEANIA") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r11 <- data_shadow %>%
  filter(Region == "SUB-SAHARAN AFRICA") %>%
  mutate(Climate = ifelse(is.na(Climate), round(2*mean(Climate, na.rm = TRUE)/2, 0), Climate))
r12 <- data_shadow %>%
  filter(Region == "WESTERN EUROPE") %>%
  mutate(Climate = ifelse(is.na(Climate), round(mean(Climate, na.rm = TRUE), 0), Climate))
data_shadow <- bind_rows(r1, r2, r3, r4, r5, r6, r7, r8, r9, r10, r11, r12)
mod_birth <- lm(data_shadow, formula = Birth_rate ~ log(Phones))
coefficients(mod_birth)
library(broom)
rsq <- glance(mod_birth) %>% select(`r.squared`)
rsq
```
- R-squared indicates relatively good model fit
---

#### 1. Do countries with lower population densities have higher GDP per Capita?

- Scatterplot (x=GDP per capita, y=Population Density, colour = Country)
- Log y scale for easier visualisation 
```{r}
data <- read.csv("countries cleaned.csv")
library(plotly)
p1<-ggplot(data=data, aes(x =GDP_per_capita, y = Population_density, colour=Region)) +
  geom_point()+ scale_y_log10()+ggtitle("GDP PER CAPITA AND POPULATION \n DENSITY COMPARISON (REGION)")+xlab("GDP PER CAPITA")+ylab("POPULATION DENSITY")+
  theme(plot.title = element_text(size=13,hjust = 0.5))
ggplotly(p1)

```
- Weak Correlation factor of 0.19
- Reject our hypothesis that countries with a lower population density may have higher GDP per Capita 
- Countries such as India and China had very high populations and low GDP per Capita 
- Conversely San Marino and Luxembourg had very high GDP per Capita and low population rates
- Mauritius can act as global average of population density compared to GDP per capita
---

#### 2. Which global regions are people tending to migrate to and which regions are people tending to emigrate from? 

- Ordered from negative to positive net migration 
```{r}
library(forcats)
ordered_migration <- order(data$Net_migration, decreasing=TRUE)
p5<-ggplot(data, aes(fct_reorder(Country,Net_migration), Net_migration,colour=Region)) +
    geom_bar(stat = "identity") + 
  ggtitle("NET MIGRATION BY COUNTRY")+
    labs(y = "Net Migration", x = "Country")+
theme(plot.title = element_text(size=18,hjust = 0.5),
        axis.text.x=element_blank(), axis.ticks.x=element_blank())

ggplotly(p5)
```

---

- Limited by unknown time period
- Use of unique data characteristics to estimate time period: Afghanistan's unexpectedly high net migration rate of 23 per 1000
- Iran launched a repatriation program deeming Afghans in Iran of a lower status 
- Secondary sources recording net positive migration of 20+ out of 1000 in Afghanistan during time period 1992-1995 
- Some stong positive net migration in the Near East (Kuwait and Qatar) and almost all of Western Europe 
- Stong negative net migration from Oceanic islands (Samoa and Fiji) as well as Latin American countries (Ecuador and Dominica)

---
#### 3. What relationships exist between Infant Mortality, GDP per Capita, Literacy Rates and Phones per 1000? 


```{r fig.height=6, fig.width=6}
#Scatterplot visualisation 2 
library(psych)
pairs.panels(data[,8:11], 
             method = "pearson", 
             hist.col = "blue",
             density = TRUE,
             ellipses = TRUE 
             )
```

---

- Decreasing exponential relationship between Infant Mortality and GDP per capita
- Limitations in modern medicine and law of diminishing returns 
- Strong linear relationship between Phones and GDP per Capita (correlation coefficient of 0.83) 
- Perhaps phones can be used as a good proxy variable/ indicator of economic wealth 
- Strong negative correlation (-0.72) between Infant Mortality and Literacy Rate 
- Government funding towards health and education tend to reflect one another 

---

#### 4. What sectors do countries from different regions primarily rely on as a source of income?

- Proportioned Bar Chart (x = country, y = ratio of sector income)
- Each included country is representative of the broader region based on their exhibition of typical or mean features
```{r}
dataG<-data
repCountries<-c("Philippines","Latvia","Ukraine","Croatia","Grenada","Lebanon","Egypt","Canada","Tonga","Nigeria","Italy")
my_cols<- c(474,473,134)
dataG<-dataG %>% gather(Category, Ratio, Agriculture:Service)%>%filter(Country %in%repCountries)
ggplot(data=dataG, aes(x=Country, y=Ratio,fill=Category)) +
    geom_bar(stat="identity", position="fill")+
  theme(axis.text.x = element_text(angle =45, hjust = 1))
```

---

- Division into Agriculture, Industry and Service sectors 
- In Grenada the Service industry dominates significantly making up 75% of the total
- 70% of the service sector in Grenada can be attributed to tourism 
- Nigeria has the lowest Service rate and instead relies heavily on the  Industry and Agriculture sectors 
- Agriculture, Oil, Mining and Energy are listed as Nigeria's major sources of income 
- Results for individual countries within a region vary significantly 
---

# Conclusion
- Essential to know the time period of the dataset and have a legend explaining all variables
- No strong relationship could be identified between GDP per Capita and population or population density
- The strongest positive net migration existed amongst Western European countries and some Near East Countries 
- The strongest emigration was found amongst Oceanic islands and Latin American countries
- Significant relationships between variables Infant Mortality, GDP per Capita, Literacy Rate and Phones existed 
- In the countries for which we observed Revenue categories, the service sector appeared to be the largest, followed by Industry and then Agriculture 

---
# References
- Hadley, W. and Garrett, G. (2016). R for Data Science
- Amiotoni, F. (2011). American Samoa Bar Association 
- Central Intelligence Agency (2017). The World Fact Book 
- Reid, M. (2017). Afghanistan: Displacement Challenges in a Country on the Move 
- Local Tips for R (2017). Basics of R Objects, Entering and Manipulating Data 
- Jantzi, K. (2014). Population Density vs. Wealth 
- STHDA (2018). Correlation Tests 
- Packages we used in R:
 [tidyverse, purrr, visdat, naniar, ggplot2, plotly, forcats, dplyr]
---
