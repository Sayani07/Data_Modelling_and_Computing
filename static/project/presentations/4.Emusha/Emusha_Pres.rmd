---
title: "Foodborne Disease Outbreaks in the United States"
author: Emusha
date: "May 22, 2018"
output:
  xaringan::moon_reader:
    css: ["default","myremark.css"]
    self_contained: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  echo=FALSE,
  comment = "",
  fig.height = 4,
  fig.width = 8,
  fig.align = "center",
  cache = FALSE
)
library(tidyverse)
library(visdat)
```

# Overview

- Exploring the Data
- Cleaning the Data
- Questions
- Seasonality
- Geospatial Effects
- Etiology Effects
- Conclusions
- References

---
# Data description
The data chosen by our team examines the outbreaks of food poisoning across the United States of America. It was created by the Centres for Disease Control and Prevention (CDC). This data is used by different departments including state, local and territorial departments, as it is a dynamic tool in identifying the source of the contamination.  
 
URL: https://wwwn.cdc.gov/norsdashboard/
---
#  What's in the data
- Time
- Location
- Type of disease
- No of illnesses
- No of deaths
- No of hospitalisations
- Likely source
---
#   Exploring and tidying the data
####1. Check variable data types within the data set
####2. Identifying and Dealing with NA
####3. Tidying the data
Etiology, Setting, Etiology Status, Imputations
```{r}
projectdata <- read_csv("FoodData.csv")
vis_miss(projectdata, sort_miss=TRUE) + theme(aspect.ratio=0.5)
```


```{r}
library(knitr)
opts_chunk$set(fig.align = 'center',echo=FALSE)
library(tidyverse)
library(ggplot2)
library(readr)
library(readxl)
library(modelr)
library(plotly)
library(lubridate)
library(stringr)
```
---
#  Questions
###1. Is there a seasonality to the number of outbreaks?
###2. Is there an increase or decrease in food-borne outbreaks as time passes?
###3. Are there certain regions that have more outbreaks?
###4. Is the level of infection affected by population?
###5. If there are more hospitalisations does this lead to more fatalities? 
###6. Is there a pattern to the extent of the outbreak depending on the genus species?

---
# Seasonality
####1. Is there a seasonality to the number of outbreaks? Is it seasonally or monthly?
####2. Is there an increase or decrease in food-borne outbreaks as time passes?
- The relationship between season (winter, spring, summer, autumn), year and number of outbreaks.
- Variable used: Season (calculated), Year and Grouped Outbreaks.
- Lineplot and Linear Regression Line (x=Season, Year, y=Number of Outbreaks)
---
```{r}
cleandata <- read_csv("CleanFoodData.csv")
dataseason <- cleandata %>%
  mutate(Month = sprintf("%02d", Month)) %>%
  mutate(winter = ifelse(Month %in% c('12', '01', '02'), 1, "")) %>%
  mutate(summer = ifelse(Month %in% c('06', '07', '08'), 3, "")) %>%
  mutate(autumn = ifelse(Month %in% c('09', '10', '11'), 4, "")) %>%
  mutate(spring = ifelse(Month %in% c('03', '04', '05'), 2, "")) %>%
  unite(season, winter, summer, autumn, spring, sep = "") %>%
  select(season, Year) %>%
  mutate(Season = paste(Year, season, sep = '')) %>%
  group_by(Season) %>%
  summarise(incident_per_season = n())
dataseason <- dataseason %>%
  mutate(Seasons = -1 + 3*(as.numeric(row.names(dataseason))-1))

dataseason$Season <- as.numeric(as.character(dataseason$Season))

datayear <- cleandata %>%
  select(Year) %>%
  group_by(Year) %>%
  summarise(incident_per_year = n())
datayear <- datayear %>%
  mutate(Years = 12*(as.numeric(row.names(datayear))-1))

s <- ggplot() +
  geom_line(data = dataseason, stat="identity", mapping = aes(
    x = Seasons,
    y = incident_per_season/3, colour = "Season")) +
  geom_line(data = datayear, stat="identity", mapping = aes(
    x = Years,
    y = incident_per_year/12, colour = "Year")) +
  geom_smooth(data = datayear, method = "lm", span = 0.20, se = FALSE, mapping = aes(
    x = Years,
    y = incident_per_year/12, colour = "Linear Regression")) 
s2 <- s + theme(legend.position = "bottom") + ggtitle("Plot5. Time Analysis of Number of Outbreaks")
s2
```
##Analysis
Overall the number of cases have gone down

Summer appears to have the highest incidence of outbreak

Perhaps due to increased tourism or warmer weather
---
#Geospatial Effects
####3. Are there certain regions that have more outbreaks?
- The relationship between location and number of outbreaks
- Variable used: Location and Number of Outbreaks.
- Polygonplot (x=lon, y=lat, colour = number of outbreaks)

####4. Is the level of infection affected by population?
- The relationship between location and number of outbreaks per 1000 people in population
- Variable used: Location and Number of Outbreaks per 1000 people in population (Population taken from Wikipedia).
- Polygonplot (x=lon, y=lat, colour = number of outbreaks per 1000 people in population)
---
###Number of Outbreaks
```{r fig.width=15, fig.height=9}
Total <-  read_csv("Total.csv")

p1 <- ggplot()
p1 <- p1 + geom_polygon(data= Total, aes(x=long, y=lat, group = group, fill=Total$state_outbreaks),colour="white"
) + scale_fill_continuous(low = "thistle2", high = "darkred", guide="colorbar")
P1 <- p1 + theme_bw()  + labs(fill = "Number of Outbreaks by State", x="", y="")
P1 + scale_y_continuous(breaks=c()) + scale_x_continuous(breaks=c()) + theme(panel.border =  element_blank())
```
---
###Number of Outbreaks per 1000 people
```{r fig.width=21, fig.height=12.5}
outbreaktot <-  read_csv("OutTotal.csv")

p2 <- ggplot()
p2 <- p2 + geom_polygon(data= outbreaktot, aes(x=long, y=lat, group = group, fill=outbreaktot$outbreaks),colour="white"
) + scale_fill_continuous(low = "lightskyblue1", high = "navyblue", guide="colorbar")
P2 <- p2 + theme_bw()  + labs(fill = "Number of Outbreaks by State per 1000 people", x="", y="")
P2 + scale_y_continuous(breaks=c()) + scale_x_continuous(breaks=c()) + theme(panel.border =  element_blank())

```
---
##Analysis
Two regions with the greatest number of outbreaks are California and Florida without Population

Maine and Wyoming both have a lower number of outbreaks in total

When taking into account population, however it indicates that their incidence is much higher per person

---
#Species Effects
####5. If there are more hospitalisations does this lead to more fatalities?
- The relationship between hospitalisations and deaths.
- Variable used: Hospitalizations and Deaths.
- Scatterplot (x=Hospitalizations, y=Deaths)
---
```{r}
ggplot(data=filter(cleandata, Hospitalizations>0), 
       aes(x=Hospitalizations, y=Deaths)) +
  geom_point() + geom_smooth(method="lm") +ggtitle("Linear Relationship") +scale_x_log10()
```
##Analysis
A weak linear trend between hospitalisations and deaths.

Most of the points are assembled between 0 to 100 hopitalisation cases.

As number of hospitalisations increases deaths decreases
---
####6. Is there a pattern to the extent of the outbreak depending on the genus species?
- The relationship between Illnesses and Genus species
- Variable used: Ilnesses and Species
- Barplot (x=Species, y=Ilnesses)


```{r}
Species <- rename(cleandata,Species=Etiology)
ggplot(Species, aes(x = Species, y = Illnesses , fill = Setting)) + 
  geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + ggtitle("Number of Outbreaks by Setting")
```
---

```{r}
ggplot(Species, aes(x = Species, y = Deaths,  fill = Setting)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, hjust = 1))+ ggtitle("Number of Deaths by Setting")

ggplot(Species, aes(x = Species, y= Hospitalizations,  fill = Setting)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + ggtitle("Number of Hospitalisations by Setting")
```
---
##Analysis
More than 50% of species causing outbreaks cause stomach flu/gastro 

Norovirus 145263 outbreaks, Salmonella 68845, Clostridium 31973 and Unknown 79649 (missing)

Norovirus and Salmonella causes gastro and Clostridium can produce botulinum toxin (similar symptoms as gastro)

All seems to have one thing in common, contracted from private home, restaurants and prisons

Norovirus is cause to highest number of outbreaks, however, Salmonella is the number 1 cause of hospitalisation 2552 cases nand listeria monocytogenes number 1 cause of deaths 132 cases.

---
#Conclusions

Avoid California and Florida on Holiday or visit during the colder months.

If you're going to get sick it will be most likely due to Clostridium or Norovirus

You're most likely to contract at home, in a restaurant or in prison (nowhere is safe)
---
#References
Centers for Disease Control and Prevention. (2017, November 27). National Outbreak Reporting System (NORS). Retrieved from https://wwwn.cdc.gov/norsdashboard/.

R Core Team. (2017). R: A Language and Environment for Statistical Computing. Retrieved from https://www.R-project.org/ 

Tierney, N., Cook, D., McBain, M., & Fay, C. (2018). Naniar: Data Structures, Summaries, and Visualisation for Missing Data. Retrieved from https://github.com/njtierney/naniar

Tierney, N. (2017). visdat: Preliminary Data Visualisation. Retrieved from https://CRAN.R-project.org/package=visdat

Gagolewski, M. (2017). R package stringi: Character string processing facilities. Retrieved from http://www.gagolewski.com/software/stringi/ 

Robinson, D. (2018). broom: Convert Statistical Analysis Objects into Tidy Data Frames. Retrieved from https://CRAN.R-project.org/package=broom

---
Wickham, H., Hester, J., & Chang, W. (2018). devtools: Tools to Make Developing R Packages Easier. Retrieved from https://CRAN.R-project.org/package=devtools 

Auguie, B. (2017). gridExtra: Miscellaneous Functions for “Grid” Graphics. Retrieved from https://CRAN.R-project.org/package=gridExtra 

Wickham, H. (2017). tidyverse: Easily Install and Load the ‘Tidyverse’. Retrieved from https://CRAN.R-project.org/package=tidyverse 

Becker, R., Wilks, A., & Brownrigg, R. (2018). maps: Draw Geographical Maps. Retrieved from https://CRAN.R-project.org/package=maps 

Wikipedia. (2015). List of U.S. states and territories by population. Retrieved from https://en.wikipedia.org/wiki/List_of_U.S._states_and_territories_by_population

